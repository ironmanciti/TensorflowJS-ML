<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
    <title>Multi-Class Classification - iris.csv</title>
</head>
    <script lang="js">
        async function run(){
            const csvUrl = 'iris.csv'
            const trainingData = tf.data.csv(csvUrl, {
                columnConfigs: {
                    species: {
                        isLabel: true
                    }
                }
            });
            //await trainingData.take(3).forEachAsync(e => console.log(e));
            //console.log(await trainingData.columnNames());
            const numFeatures = (await trainingData.columnNames()).length - 1;  //species column 제외

            const convertedData = trainingData.map(({xs, ys}) => {
                const labels = [
                    ys.species == 'setosa' ? 1 : 0,
                    ys.species == 'versicolor' ? 1 : 0,
                    ys.species == 'virginica' ? 1 : 0
                ]
                return {xs: Object.values(xs), ys: Object.values(labels)};
            }).batch(10);

            const model = tf.sequential();
            model.add(tf.layers.dense({inputShape: [numFeatures], activation: 'relu', units: 5}));
            model.add(tf.layers.dense({activation: 'softmax', units: 3}));

            model.compile({loss: 'categoricalCrossentropy', optimizer: tf.train.adam(0.1)});

            await model.fitDataset(convertedData, {
                epochs: 100, 
                callbacks: {
                    onEpochEnd: async(epoch, logs) => {
                        console.log("Epoch: " + epoch + "Loss: " + logs.loss)
                    }
                }
            })
        }
        run();
    </script>
<body>
    <h1>Simple Multi-class classification</h1>
</body>

</html>